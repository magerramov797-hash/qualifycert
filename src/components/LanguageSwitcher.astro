---
const { currentLang = "az", currentPath = "/" } = Astro.props;

const knownPaths = new Set([
  "/",
  "/services/",
  "/services/certification/",
  "/services/audit/",
  "/services/training/",
  "/training/",
  "/standards/",
  "/standards/iso-9001/",
  "/standards/iso-14001/",
  "/standards/iso-45001/",
  "/standards/iso-22000/",
  "/standards/haccp/",
  "/blog/",
  "/faq/",
  "/about/",
  "/contact/",
  "/privacy/",
  "/cookies/",
  "/thank-you/",
  "/industries/"
]);

const normalizedPath =
  typeof currentPath === "string" && currentPath.trim().length > 0
    ? currentPath
    : "/";

const basePath = knownPaths.has(normalizedPath) ? normalizedPath : "/";

const linkFor = (lang) => {
  if (lang === "az") return basePath;
  return `/${lang}${basePath === "/" ? "/" : basePath}`;
};
---

<div class="lang-dd">
  <button class="lang-btn" type="button" aria-haspopup="menu">
    {currentLang.toUpperCase()} <span class="lang-caret" aria-hidden="true">â–¾</span>
  </button>

  <div class="lang-menu" role="menu">
    <a role="menuitem" href={linkFor("az")} class={currentLang === "az" ? "is-active" : ""}>AZ</a>
    <a role="menuitem" href={linkFor("ru")} class={currentLang === "ru" ? "is-active" : ""}>RU</a>
    <a role="menuitem" href={linkFor("en")} class={currentLang === "en" ? "is-active" : ""}>EN</a>
  </div>
</div>

<style is:global>
  .lang-dd{
    position: relative;
    display: inline-flex;
    align-items: center;
  }
  .lang-btn{
    display:inline-flex;
    align-items:center;
    gap: 6px;
    padding: 10px 12px;
    border-radius: 999px;
    border: 1px solid var(--line);
    background: #fff;
    font-weight: 700;
    font-size: 12px;
    cursor: pointer;
    white-space: nowrap;
  }
  .lang-caret{ font-size: 11px; opacity:.6; transform: translateY(-1px); }

  .lang-menu{
    position: absolute;
    right: 0;
    top: calc(100% + 8px);
    min-width: 96px;
    padding: 8px;
    border-radius: var(--radius);
    background: var(--card);
    border: 1px solid var(--line);
    box-shadow: var(--shadow-md);
    display: none;
    z-index: 70;
  }
  .lang-menu a{
    display:block;
    padding: 9px 10px;
    border-radius: 12px;
    border: 1px solid transparent;
    font-weight: 700;
    font-size: 13px;
  }
  .lang-menu a:hover{
    border-color: rgba(37,99,235,.18);
    background: rgba(37,99,235,.04);
    color: inherit;
  }
  .lang-menu a.is-active{
    background: rgba(37,99,235,.08);
    border-color: rgba(37,99,235,.18);
  }

  /* hover + keyboard */
  .lang-dd:hover .lang-menu,
  .lang-dd:focus-within .lang-menu{
    display:block;
  }
</style>
